<?xml version="1.0"?>

<project name="wsrp" basedir="." default="deploy">
	<import file="../build-common-portlet.xml" />

	<target name="build-lang">
		<antcall target="build-lang-cmd">
			<param name="lang.dir" value="docroot/WEB-INF/src/content/wsrp-portlet" />
			<param name="lang.file" value="Language" />
		</antcall>
	</target>

	<target name="build-wsdl">
		<tstamp>
			<format property="tstamp.value" pattern="yyyyMMddkkmmssSSS" />
		</tstamp>

		<mkdir dir="${tstamp.value}" />

		<path id="plugin-lib.classpath">
			<fileset dir="${app.server.lib.portal.dir}" includes="*.jar" />
			<fileset dir="docroot/WEB-INF/lib" includes="*.jar" />
			<pathelement location="docroot/WEB-INF/classes" />
		</path>

		<java
			classname="org.apache.cxf.tools.wsdlto.WSDLToJava"
			classpathref="plugin.classpath"
			dir="docroot/wsdl"
			fork="true"
			maxmemory="256m"
			newenvironment="true"
		>
			<arg value="-verbose" />
			<arg value="-p" />
			<arg value="urn:oasis:names:tc:wsrp:v2:types=com.liferay.wsrp.soap.v2.types" />
			<arg value="-p" />
			<arg value="urn:oasis:names:tc:wsrp:v2:intf=com.liferay.wsrp.soap.v2.intf" />
			<arg value="-p" />
			<arg value="urn:oasis:names:tc:wsrp:v2:wsdl=com.liferay.wsrp.soap.v2.wsdl" />
			<arg value="-b" />
			<arg value="wsrp-2.0-custom-bindings.xml" />
			<arg value="-d" />
			<arg value="../../${tstamp.value}" />
			<arg value="wsrp-2.0-service.wsdl " />
		</java>

		<javac
			classpathref="plugin.classpath"
			compiler="${javac.compiler}"
			debug="${javac.debug}"
			deprecation="${javac.deprecation}"
			destdir="${tstamp.value}"
			nowarn="${javac.nowarn}"
			srcdir="${tstamp.value}"
		/>

		<zip
			basedir="${tstamp.value}"
			destfile="docroot/WEB-INF/lib/wsrp-client.jar"
		/>

		<delete dir="${tstamp.value}" />
	</target>
</project>