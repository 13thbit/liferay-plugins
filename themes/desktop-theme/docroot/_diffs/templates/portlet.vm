## --- Common --- ##

#set ($userLocalService = $serviceLocator.findService("com.liferay.portal.service.UserLocalService"))
#set ($organizationLocalService = $serviceLocator.findService("com.liferay.portal.service.OrganizationLocalService"))

#set ($portlet_display = $portletDisplay)

## --- Group name --- ##

#set ($group_name = "")

#if ($layout.getGroup().isUser())
	#set ($user2 = $userLocalService.getUserById($layout.getGroup().getClassPK()))
	#set ($group_name = $user2.getFullName())
#elseif ($layout.getGroup().isOrganization())
	#set ($organization = $organizationLocalService.getOrganization($layout.getGroup().getClassPK()))
	#set ($group_name = $organization.getName())
#else
	#set ($group_name = $layout.getGroup().getName())
#end

## --- Portlet --- ##

#set ($portlet_id = $portlet_display.getId())
#set ($portlet_title = $portlet_display.getTitle())
#set ($portlet_content = $portlet_display.getContent())
#set ($portlet_back_url = $portlet_display.getURLBack())
#set ($portlet_column_pos = $portlet_display.getColumnPos())

#set ($is_maximized = $portletDisplay.isStateMax())
#set ($images_folder = "$themeDisplay.getPathThemeImages()/portlet")
#set ($portlet_address = "$group_name - $layout.getHTMLTitle($locale) - $portlet_title")

<table class="portlet" id="portlet-wrapper-$portlet_id">
<tr>
	<td class="top-left"><img width="15" src="$images_folder/top_left.png" /></td>
	<td class="top-center">
		<div class="portlet-topper">
			<span class="portlet-title not-editable">
				$theme.iconPortlet() $portlet_title
			</span>

			<span class="portlet-icons" id="portlet-small-icon-bar_$portlet_id">
				#if ($portlet_display.isShowBackIcon())
					<a href="$portlet_back_url" class="portlet-icon-back">#language ("return-to-full-page")</a>
				#elseif ($portlet_display.isShowCloseIcon())
					<span class="icon-min"><a href="javascript: Desktop.portletMinimize('$portlet_display.getId()');"></a></span>
					<span class="icon-max"><a href="javascript: submitForm(document.hrefFm,'$portlet_display.getURLMax()')"></a></span>
					<span class="icon-close"><a href="javascript: Desktop.portletRemove('$portlet_display.getId()','$portlet_column_pos');"></a></span>
				#end
			</span>
		</div>
	</td>
	<td class="top-right"><img width="16" src="$images_folder/top_right.png" /></td>
</tr>
<tr>
	<td class="header-left"><img width="15" src="$images_folder/header_left.png" /></td>
	<td class="header-center">
		<div class="portlet-address">
			$portlet_address

			#if (!$portlet_display.isShowBackIcon())
				<span class="portlet-icons icon-options">$theme.iconOptions()</span>
			#end
		</div>
	</td>
	<td class="header-right"><img width="16" src="$images_folder/header_right.png" /></td>
</tr>
<tr>
	<td class="middle-left"></td>
	<td class="middle-center" valign="top">
		<div class="portlet-content">
			$portlet_content
		</div>
	</td>
	<td class="middle-right"></td>
</tr>
<tr>
	<td class="bottom-left"><img width="15" src="$images_folder/bottom_left.png" /></td>
	<td class="bottom-center"></td>
	<td class="bottom-right"><img width="16" src="$images_folder/bottom_right.png" /></td>
</tr>
</table>

<script type="text/javascript">
	($is_maximized) ? Desktop.portletMaximize('$portlet_id') : Desktop.taskbarAddPortlet('$portlet_id');
</script>