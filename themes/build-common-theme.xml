<?xml version="1.0"?>

<project name="build-common-theme">
	<property name="project.dir" value="../.." />

	<import file="../build-common-plugin.xml" />

	<target name="clean">
		<if>
			<available file="docroot/_diffs" />
			<then>
				<delete includeemptydirs="true" quiet="true" failonerror="false">
					<fileset
						dir="docroot"
						excludes="_diffs.*,_diffs/**,WEB-INF/**"
					/>
				</delete>
			</then>
		</if>
	</target>

	<target name="compile">
		<if>
			<equals arg1="${theme.extension}" arg2="unstyled" />
			<then>
				<copy todir="docroot" overwrite="yes">
					<fileset
						dir="${app.server.portal.dir}/html/themes/_unstyled"
						excludes="templates/init.vm"
					/>
				</copy>
			</then>
			<elseif>
				<equals arg1="${theme.extension}" arg2="styled" />
				<then>
					<copy todir="docroot" overwrite="yes">
						<fileset
							dir="${app.server.portal.dir}/html/themes/_unstyled"
							excludes="templates/init.vm"
						/>
					</copy>

					<copy todir="docroot" overwrite="yes">
						<fileset
							dir="${app.server.portal.dir}/html/themes/_styled"
						/>
					</copy>
				</then>
			</elseif>
		</if>

		<if>
			<available file="docroot/_diffs" />
			<then>
				<copy todir="docroot" overwrite="yes">
					<fileset
						dir="docroot/_diffs"
					/>
				</copy>
			</then>
		</if>
	</target>

	<target name="war" depends="merge">
		<mkdir dir="${project.dir}/dist" />

		<zip
			basedir="docroot"
			destfile="${plugin.file}"
			excludes="_diffs.*,_diffs/**"
		/>
	</target>
</project>