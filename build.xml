<?xml version="1.0"?>

<project name="plugins" basedir="." default="all">
	<property name="project.dir" value="." />

	<import file="build-common.xml" />

	<target name="all">
		<antcall target="clean" />
		<antcall target="deploy" />
	</target>

	<target name="clean">
		<ant dir="layouttpl" target="clean" inheritAll="false" />
		<ant dir="portlets" target="clean" inheritAll="false" />
		<ant dir="themes" target="clean" inheritAll="false" />
		<ant dir="webs" target="clean" inheritAll="false" />
	</target>

	<target name="compile">
		<ant dir="layouttpl" target="compile" inheritAll="false" />
		<ant dir="portlets" target="compile" inheritAll="false" />
		<ant dir="themes" target="compile" inheritAll="false" />
		<ant dir="webs" target="compile" inheritAll="false" />
	</target>

	<target name="war">
		<ant dir="layouttpl" target="war" inheritAll="false" />
		<ant dir="portlets" target="war" inheritAll="false" />
		<ant dir="themes" target="war" inheritAll="false" />
		<ant dir="webs" target="war" inheritAll="false" />
	</target>

	<target name="deploy">
		<ant dir="layouttpl" target="deploy" inheritAll="false" />
		<ant dir="portlets" target="deploy" inheritAll="false" />
		<ant dir="themes" target="deploy" inheritAll="false" />
		<ant dir="webs" target="deploy" inheritAll="false" />
	</target>

	<target name="build-summary">
		<java
			classname="com.liferay.portal.tools.PluginsSummaryBuilder"
			classpathref="portal.classpath"
			fork="true"
			newenvironment="true"
		>
			<jvmarg value="-Dplugins.dir=${project.dir}" />
		</java>

		<java
			classname="com.liferay.portal.tools.XSLTBuilder"
			classpathref="portal.classpath"
			fork="true"
			newenvironment="true"
		>
			<arg value="${project.dir}/summary.xml" />
			<arg value="${project.dir}/summary.xsl" />
			<arg value="${project.dir}/summary.html" />
		</java>
	</target>

	<target name="extract-plugins-sdk">
		<mkdir dir="dist" />

		<delete file="dist/liferay-plugins-sdk-${lp.version}.zip" />

		<zip
			basedir="."
			destfile="dist/liferay-plugins-sdk-${lp.version}.zip"
			excludes="build.*.properties,dist/**,hooks/*-hook/**,layouttpl/*-layouttpl/**,portlets/*-portlet/**,portlets/alfresco/**,summary.*,themes/*-theme/**,webs/*-web/**"
		/>
	</target>
</project>