<?xml version="1.0" encoding="UTF-8"?>

<beans
	xmlns="http://www.springframework.org/schema/beans"
	xmlns:aop="http://www.springframework.org/schema/aop"
	xmlns:context="http://www.springframework.org/schema/context"
	xmlns:sec="http://www.springframework.org/schema/security"
	xmlns:tx="http://www.springframework.org/schema/tx"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-2.5.xsd http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-2.5.xsd http://www.springframework.org/schema/security http://www.springframework.org/schema/security/spring-security-2.0.4.xsd http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-2.5.xsd"
>

	<!-- Managers -->

	<bean id="abstractManager" abstract="true">
		<property name="defaultSetupId" value="org.edorasframework.process.api.setup.Default" />
	</bean>
	<bean id="workflowDefinitionManager" class="com.liferay.portal.workflow.edoras.WorkflowDefinitionManagerImpl" parent="abstractManager" />
	<bean id="workflowEngineManager" class="com.liferay.portal.workflow.edoras.WorkflowEngineManagerImpl" parent="abstractManager" />
	<bean id="workflowInstanceManager" class="com.liferay.portal.workflow.edoras.WorkflowInstanceManagerImpl" parent="abstractManager" />
	<bean id="workflowTaskManager" class="com.liferay.portal.workflow.edoras.TaskInstanceManagerImpl" parent="abstractManager" />

	<!-- Transaction -->

	<tx:advice id="transactionAdvice" transaction-manager="portalTransactionManager">
		<tx:attributes>
			<tx:method name="find*" read-only="true" />
			<tx:method name="get*" read-only="true" />
		</tx:attributes>
	</tx:advice>
	<aop:config>
		<aop:pointcut id="transactionOperation" expression="bean(workflow*Manager)" />
		<aop:advisor advice-ref="transactionAdvice" pointcut-ref="transactionOperation" />
	</aop:config>

	<!-- Listeners -->

	<bean id="messageListener.workflow_definition" class="com.liferay.portal.kernel.messaging.proxy.ProxyMessageListener">
		<property name="manager" ref="workflowDefinitionManager" />
	</bean>
	<bean id="messageListener.workflow_engine" class="com.liferay.portal.kernel.messaging.proxy.ProxyMessageListener">
		<property name="manager" ref="workflowEngineManager" />
	</bean>
	<bean id="messageListener.workflow_instance" class="com.liferay.portal.kernel.messaging.proxy.ProxyMessageListener">
		<property name="manager" ref="workflowInstanceManager" />
	</bean>
	<bean id="messageListener.workflow_task" class="com.liferay.portal.kernel.messaging.proxy.ProxyMessageListener">
		<property name="manager" ref="workflowTaskManager" />
	</bean>

	<!-- Configurator -->

	<bean id="messagingConfigurator" class="com.liferay.portal.kernel.messaging.config.PluginMessagingConfigurator" init-method="init" destroy-method="destroy">
		<property name="messageListeners">
			<map key-type="java.lang.String" value-type="java.util.List">
				<entry key="liferay/workflow_definition">
					<list value-type="com.liferay.portal.kernel.messaging.MessageListener">
						<ref bean="messageListener.workflow_definition" />
					</list>
				</entry>
				<entry key="liferay/workflow_engine">
					<list value-type="com.liferay.portal.kernel.messaging.MessageListener">
						<ref bean="messageListener.workflow_engine" />
					</list>
				</entry>
				<entry key="liferay/workflow_instance">
					<list value-type="com.liferay.portal.kernel.messaging.MessageListener">
						<ref bean="messageListener.workflow_instance" />
					</list>
				</entry>
				<entry key="liferay/workflow_task">
					<list value-type="com.liferay.portal.kernel.messaging.MessageListener">
						<ref bean="messageListener.workflow_task" />
					</list>
				</entry>
			</map>
		</property>
	</bean>
</beans>